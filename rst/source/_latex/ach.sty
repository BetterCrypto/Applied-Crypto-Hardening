%fixme
\providecommand*\ac[1]{#1}
\providecommand*\acs[1]{#1{}s}


\RequirePackage{textcomp}
\RequirePackage{relsize}

% For searchable pdfs
\input glyphtounicode
\pdfgentounicode=1


% Setup KOMA script
\RequirePackage{scrhack}
\KOMAoptions{%
  ,DIV=12%
  ,parskip=true%
}
% The page
\RequirePackage[footsepline]{scrpage2}
\RequirePackage{lastpage}

% for development
\RequirePackage{ifdraft}
\ifdraft{%
  \errorcontextlines=999
  %% Heavy debugging
  %\RequirePackage{showframe}
  \RequirePackage{blindtext}
  \RequirePackage{eso-pic}
  \newsavebox{\draftPageLine}
  \newsavebox{\draftWatermark}
  \AddToShipoutPicture{%
    \AtPageLowerLeft{\usebox{\draftWatermark}}
    \AtPageUpperLeft{%
      \raisebox{-\height}[\height][0pt]{\usebox{\draftPageLine}}}%
    \AtPageLowerLeft{%
      \raisebox{\depth}[\height][0pt]{\usebox{\draftPageLine}}}%
  }
}{
  \let\blindtext\relax
  \let\Blindtext\relax
  \let\blinddocument\relax
  \let\Blinddocument\relax
}

% Creating a horizontal rule
\newcommand*{\HorRule}{%
  \color{darkblue}%
  \rule{\linewidth}{1pt}%
}

% Colors
\definecolor{green}{RGB}{32,113,10}
\definecolor{orange}{RGB}{251,111,16}
\definecolor{red}{RGB}{247,56,0}
\definecolor{blue}{RGB}{0,28,128}
\definecolor{lightgreen}{RGB}{187,218,216}
\definecolor{intersectgreen}{RGB}{103,133,155}
\definecolor{darkblue}{RGB}{76,87,117}
\definecolor{Brown}{cmyk}{0,0.81,1,0.60}
\definecolor{OliveGreen}{cmyk}{0.64,0,0.95,0.40}
\definecolor{CadetBlue}{cmyk}{0.62,0.57,0.23,0}
\definecolor{lightlightgray}{gray}{0.9}

% Draft stuff
\ifdraft{
  % Ensure that everything is neatly set up for us
  \AtBeginDocument{
    \def\draftInfo{%
      Draft revision\gitVtags: \gitAbbrevHash{} %
      (\gitCommitterIsoDate) \gitCommitterName}
    \sbox{\draftWatermark}{%
      \includegraphics[width=\paperwidth]{img/draft}}
    \sbox{\draftPageLine}{%
      \colorbox{black!10}{%
        % enlarge box vertically by 2/3 lines
        \raisebox{0pt}%
        [\dimexpr .33\baselineskip + \height]%
        [\dimexpr .33\baselineskip + \depth]{%
          \makebox[\paperwidth]{\color{black!50}\draftInfo}}}}
  }
}{}


%%% Fonts
%%% Fonts
% Fonts are loaded, now is the right time for mictorype.
\microtypesetup{stretch=9,shrink=15,step=3,tracking=smallcaps,letterspace=75}
% makes default font sans-serif

%\renewcommand{\familydefault}{\sfdefault}
% Captions
\setcapindent{1em}
\addtokomafont{caption}{\small\itshape}
\addtokomafont{captionlabel}{\bfseries}

% Section headers
\addtokomafont{disposition}{\color{darkblue}\bfseries}

% Page foot
\setkomafont{pagefoot}{\normalfont\sffamily\footnotesize}
\setkomafont{pagehead}{\normalfont\sffamily\footnotesize}
\ifoot%
[Applied Crypto Hardening\ifdraft{ % Space!
  \textbullet{} \draftInfo}{}]%
{Applied Crypto Hardening \ifdraft{ % Space!
    \textbullet{} \draftInfo}{}}
\cfoot[]{}
\ofoot%
[page \thepage\ of \pageref{LastPage}]%
{page \thepage\ of \pageref{LastPage}}
\automark[subsection]{section}
\ihead{\leftmark}
\chead[]{}
\ohead{\rightmark}
\AtBeginDocument{\pagestyle{scrheadings}}

% % Epigraph / dictum
% \newcommand*{\epigraph}[3][]{\dictum[#3]{#2}\bigskip}
% \renewcommand*{\dictumrule}{}
% \renewcommand*{\dictumauthorformat}[1]{--- #1}
% \addtokomafont{dictumtext}{\itshape}
% \setkomafont{dictumauthor}{\normalfont}
% \renewcommand{\dictumwidth}{8cm}


% Disable single lines at the start of a paragraph (Schusterjungen)
\clubpenalty = 10000
% Disable single lines at the end of a paragraph (Hurenkinder)
\widowpenalty = 10000 
\displaywidowpenalty = 10000 % formulas
\setlength{\textfloatsep}{\baselineskip}
\setlength{\floatsep}{\baselineskip}

\frenchspacing
\raggedbottom

% customized spaces between text and footnotes
\setlength{\skip\footins}{2\baselineskip}


% Better float parameters: (from the TeX FAQ)
\renewcommand{\topfraction}{.85}
\renewcommand{\bottomfraction}{.7}
\renewcommand{\textfraction}{.15}
\renewcommand{\floatpagefraction}{.66}
\renewcommand{\dbltopfraction}{.66}
\renewcommand{\dblfloatpagefraction}{.66}
\setcounter{topnumber}{9}
\setcounter{bottomnumber}{9}
\setcounter{totalnumber}{20}
\setcounter{dbltopnumber}{9}
